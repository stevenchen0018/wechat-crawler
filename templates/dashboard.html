{{define "dashboard"}}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.Title}} - 微信公众号爬虫管理系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/static/css/admin.css?v=1.0.0" rel="stylesheet">
</head>
<body>
    {{template "navbar" .}}

    <div class="container-fluid mt-4">
<div class="row mb-4">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h2 class="mb-2">
                    <i class="bi bi-speedometer2 me-2"></i>系统概览
                </h2>
                <p class="text-muted mb-0">实时监控系统运行状态</p>
            </div>
            <div>
                <span class="badge bg-success">
                    <i class="bi bi-circle-fill me-1"></i>系统运行中
                </span>
            </div>
        </div>
    </div>
</div>

<!-- 统计卡片 -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card bg-primary text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-subtitle mb-2">订阅公众号</h6>
                        <h2 class="card-title mb-0">{{.Stats.AccountCount}}</h2>
                    </div>
                    <i class="bi bi-people stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card bg-success text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-subtitle mb-2">采集文章</h6>
                        <h2 class="card-title mb-0">{{.Stats.ArticleCount}}</h2>
                    </div>
                    <i class="bi bi-file-earmark-text stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card bg-info text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-subtitle mb-2">爬取间隔</h6>
                        <h2 class="card-title mb-0">{{.Stats.CrawlInterval}}<small> 分钟</small></h2>
                    </div>
                    <i class="bi bi-clock-history stat-icon"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card stat-card bg-warning text-white">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="card-subtitle mb-2">系统状态</h6>
                        <h2 class="card-title mb-0"><i class="bi bi-check-circle"></i> 运行中</h2>
                    </div>
                    <i class="bi bi-activity stat-icon"></i>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 快捷操作 -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-lightning me-2"></i>快捷操作</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3 col-sm-6">
                        <a href="/admin/accounts" class="btn btn-outline-primary btn-lg w-100" style="padding: 20px; min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <i class="bi bi-plus-circle mb-2" style="font-size: 28px;"></i>
                            <span>添加公众号</span>
                        </a>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <button onclick="triggerCrawl()" class="btn btn-outline-primary btn-lg w-100" style="padding: 20px; min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <i class="bi bi-play-circle mb-2" style="font-size: 28px;"></i>
                            <span>手动爬取</span>
                        </button>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <a href="/admin/articles" class="btn btn-outline-primary btn-lg w-100" style="padding: 20px; min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <i class="bi bi-journal-text mb-2" style="font-size: 28px;"></i>
                            <span>查看文章</span>
                        </a>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <a href="/admin/settings" class="btn btn-outline-primary btn-lg w-100" style="padding: 20px; min-height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                            <i class="bi bi-gear mb-2" style="font-size: 28px;"></i>
                            <span>系统设置</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 最新文章 -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-newspaper me-2"></i>最新采集文章</h5>
            </div>
            <div class="card-body">
                {{if .LatestArticles}}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>标题</th>
                                <th>公众号</th>
                                <th>发布时间</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{range .LatestArticles}}
                            <tr>
                                <td>{{.Title}}</td>
                                <td><span class="badge bg-primary">{{.AccountName}}</span></td>
                                <td>{{formatTime .PublishTime}}</td>
                                <td>
                                    <a href="{{.ContentURL}}" target="_blank" class="btn btn-sm btn-outline-primary">
                                        <i class="bi bi-eye"></i> 查看
                                    </a>
                                </td>
                            </tr>
                            {{end}}
                        </tbody>
                    </table>
                </div>
                {{else}}
                <div class="text-center py-5">
                    <i class="bi bi-inbox" style="font-size: 48px; color: var(--gray-300);"></i>
                    <p class="mt-3 mb-2" style="font-size: 16px; font-weight: 500;">暂无文章数据</p>
                    <p class="text-muted">添加公众号订阅后，文章会显示在这里</p>
                </div>
                {{end}}
            </div>
        </div>
    </div>
</div>
<script>
function triggerCrawl() {
    if (!confirm('确定要立即执行爬取任务吗？')) {
        return;
    }
    
    showLoading('正在执行爬取任务...');
    
    axios.post('/admin/api/tasks/trigger')
        .then(response => {
            hideLoading();
            if (response.data.code === 200) {
                showSuccess('爬取任务已启动，请稍后查看结果');
            } else {
                showError(response.data.msg || '操作失败');
            }
        })
        .catch(error => {
            hideLoading();
            showError('请求失败: ' + error.message);
        });
}
</script>
    </div>

    {{template "footer" .}}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="/static/js/admin.js?v=1.0.0"></script>
</body>
</html>
{{end}}



